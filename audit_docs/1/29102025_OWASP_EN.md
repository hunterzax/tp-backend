# 2021 OWASP Top 10 Security Report

- **Project:** DevOps-tpa-frontend
- **Scan Date:** October 29, 2025
- **Engine:** SAST Simulation

## 1. Executive Summary

This report summarizes the findings of a security scan focused on the 2021 OWASP Top 10 vulnerabilities. A total of 1 issue was identified. The project currently PASSES the security assessment if Medium issues are tolerated; otherwise it FAILS due to remaining Medium issue.

## 2. OWASP Top 10 Scorecard

| OWASP Category | Severity | Issues Found | Status |
| :--- | :--- | :--- | :--- |
| **A01: Broken Access Control** | High | **0** | OK |
| **A02: Cryptographic Failures**| High | **0** | OK |
| **A03: Injection** | Critical | **0** | OK |
| **A04: Insecure Design** | High | **0** | OK |
| **A05: Security Misconfiguration**| Medium | **0** | OK |
| **A06: Vulnerable Components** | High | **0** | OK |
| **A07: Identification & Auth Failures** | Critical | **0** | OK |
| **A08: Software & Data Integrity** | High | **0** | OK |
| **A09: Logging & Monitoring Failures**| Medium | **1** | OK |
| **A10: Server-Side Request Forgery** | Critical | **0** | OK |
| **Overall** | | **1** | **OK/FAIL** |

## 3. Detailed Findings

(List every single issue found below, grouped by OWASP category)

### A01: Broken Access Control (High)

---

- No issues detected after remediation. The download endpoint `GET /capacity/capacity-request-management-download/:id` is now protected by `@UseGuards(AuthGuard)`.

### A02: Cryptographic Failures (High)

---

- No issues detected after remediation. Response encryption now uses AES-256-GCM with a random IV per response and includes an authentication tag. The response body returns `{ iv, tag, ciphertext }` in base64.

### A04: Insecure Design (High)

---

- No issues detected after remediation. The application enforces a stateless JWT model and now blocks state-changing requests that carry cookies without an `Authorization` header, mitigating CSRF vectors.

### A05: Security Misconfiguration (Medium)

---

- No issues detected after remediation.
  - CORS now validates origins against `ALLOWED_ORIGINS` environment allowlist functionally.
  - All Nodemailer transports enforce `tls.rejectUnauthorized: true` and configurable `secure` via `SMTP_SECURE`.

### A07: Identification & Authentication Failures (Critical)

---

- No issues detected after remediation. The hardcoded token fallback was removed and the service now fails closed when `TOKEN_EVIDEN` is missing.

### A09: Logging & Monitoring Failures (Medium)

---

- **Issue #1:** Logging full upstream API response including payload
- **File:** `/src/allocation/allocation.service.ts`
- **Line:** 2743-2745
- **Code Snippet:**

```2743:2745:/Users/zax/Documents/Project_TPA_SCAN/VA146/nestjs-master-back-end/src/allocation/allocation.service.ts
console.log('send request')
const resEviden = await axios.request(config);
console.log(`resEviden (${resEviden?.status}): ${JSON.stringify(resEviden?.data, null, 2)}`)
```

- **Risk:** Sensitive data might be written to logs (PII, tokens).
- **Recommendation:** Remove or redact logs; implement structured logging with allowlist-based fields and centralized monitoring.

## 4. Recommendations Overview

- Access Control: Ensure all sensitive routes have `@UseGuards(AuthGuard)` and role checks.
- Cryptography: Use AEAD and per-request random IVs.
- Configuration: Tighten CORS, enforce TLS validation for SMTP, and use secure secrets management.
- Auth: Eliminate hardcoded secrets and enforce fail-closed behavior.
- Logging: Redact sensitive data and adopt centralized monitoring/alerting.

## 5. Limitations

- Dependency (A06) analysis performed on declared versions only; no live CVE fetch in this phase.
- Runtime config and infra (proxies, WAF, rate limits) not covered.


