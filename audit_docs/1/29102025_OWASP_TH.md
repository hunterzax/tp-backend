# รายงานความปลอดภัย 2021 OWASP Top 10

- โปรเจกต์: DevOps-tpa-frontend
- วันที่สแกน: 29 ตุลาคม 2025
- เอนจิน: SAST Simulation

## 1. สรุปผู้บริหาร

รายงานนี้สรุปผลการสแกนตามหมวดหมู่ 2021 OWASP Top 10 พบช่องโหว่ทั้งหมด 1 รายการ หากยอมรับความเสี่ยงระดับ Medium โครงการถือว่า PASS มิฉะนั้นยัง FAIL จากประเด็นระดับ Medium ที่เหลืออยู่

## 2. คะแนนตามหมวด OWASP Top 10

| หมวด OWASP | ความรุนแรง | จำนวนที่พบ | สถานะ |
| :--- | :--- | :--- | :--- |
| **A01: Broken Access Control** | High | **0** | OK |
| **A02: Cryptographic Failures** | High | **0** | OK |
| **A03: Injection** | Critical | **0** | OK |
| **A04: Insecure Design** | High | **0** | OK |
| **A05: Security Misconfiguration** | Medium | **0** | OK |
| **A06: Vulnerable Components** | High | **0** | OK |
| **A07: Identification & Auth Failures** | Critical | **0** | OK |
| **A08: Software & Data Integrity** | High | **0** | OK |
| **A09: Logging & Monitoring Failures** | Medium | **1** | OK |
| **A10: Server-Side Request Forgery** | Critical | **0** | OK |
| **ภาพรวม** |  | **1** | **OK/FAIL** |

## 3. รายละเอียดช่องโหว่

แสดงตามหมวด OWASP พร้อมไฟล์ ไลน์ และโค้ดที่เกี่ยวข้อง

### A01: Broken Access Control (High)

---

- ไม่พบปัญหาหลังการแก้ไข เอ็นพอยต์ดาวน์โหลด `GET /capacity/capacity-request-management-download/:id` ถูกป้องกันด้วย `@UseGuards(AuthGuard)` แล้ว

### A02: Cryptographic Failures (High)

---

- ไม่พบปัญหาหลังการแก้ไข การเข้ารหัส response เปลี่ยนเป็น AES-256-GCM พร้อม IV แบบสุ่มต่อ response และมี authentication tag โดยส่งคืน `{ iv, tag, ciphertext }` เป็น base64

### A04: Insecure Design (High)

---

- ไม่พบปัญหาหลังการแก้ไข ระบบทำงานแบบ Stateless JWT และบล็อกร้องขอที่เปลี่ยนสถานะซึ่งมีคุกกี้แต่ไม่มี `Authorization` header เพื่อลดความเสี่ยง CSRF

### A05: Security Misconfiguration (Medium)

---

- ไม่พบปัญหาหลังการแก้ไข
  - CORS ตรวจสอบต้นทางกับรายการอนุญาตจากตัวแปร `ALLOWED_ORIGINS`
  - Nodemailer ทุกจุดบังคับ `tls.rejectUnauthorized: true` และตั้งค่า `secure` ผ่าน `SMTP_SECURE`

### A07: Identification & Authentication Failures (Critical)

---

- ไม่พบปัญหาหลังการแก้ไข โค้ด fallback โทเค็นถูกลบ และระบบจะล้มเหลวเมื่อไม่มี `TOKEN_EVIDEN`

### A09: Logging & Monitoring Failures (Medium)

---

- รายการ #1: บันทึกข้อมูลการตอบกลับภายนอกทั้งก้อน
- ไฟล์: `/src/allocation/allocation.service.ts`
- ไลน์: 2743-2745
- โค้ด:

```2743:2745:/Users/zax/Documents/Project_TPA_SCAN/VA146/nestjs-master-back-end/src/allocation/allocation.service.ts
console.log('send request')
const resEviden = await axios.request(config);
console.log(`resEviden (${resEviden?.status}): ${JSON.stringify(resEviden?.data, null, 2)}`)
```

- ความเสี่ยง: อาจมีข้อมูลอ่อนไหว (PII/โทเค็น) ในล็อก
- คำแนะนำ: ตัดข้อมูลอ่อนไหวออก ใช้ระบบล็อกแบบโครงสร้างและจัดเก็บศูนย์กลาง

## 4. ข้อเสนอแนะโดยสรุป

- ควบคุมการเข้าถึง: ใช้ `@UseGuards(AuthGuard)` กับทุกเอ็นพอยต์สำคัญ
- การเข้ารหัส: ใช้ IV แบบสุ่มต่อคำขอ และพิจารณา AEAD
- การตั้งค่า: ลดขอบเขต CORS บังคับ TLS SMTP และจัดการความลับอย่างปลอดภัย
- การยืนยันตัวตน: เอาค่า hardcoded ออก และ fail-closed
- การเฝ้าระวัง: ลดการล็อกข้อมูลอ่อนไหวและใช้ระบบมอนิเตอร์

## 5. ข้อจำกัด

- การวิเคราะห์ช่องโหว่ไลบรารี (A06) อิงเวอร์ชันที่ประกาศเท่านั้น ไม่ดึง CVE แบบเรียลไทม์
- ไม่ครอบคลุมคอนฟิก runtime/proxy/WAF/Rate limit


